
touch keys.pem
vim keys.pem 
chmod 600 keys.pem 
ssh -i keys.pem 10.10.0.107


wget https://apt.puppet.test/puppet-tools-release-bionic.deb
sudo dpkg -i puppet-tools-release-bionic.deb
sudo apt-get update

# ###########################
# install on server
#############################
sudo apt install puppetmaster
sudo hostnamectl set-hostname master.dbzl.test
sudo vim /etc/hosts
 # put ip and hostname master
 # put ip and hostname client
cd /etc/puppet/
//sudo mkdir -p modules/nginx/manifests
//sudo vim modules/nginx/manifests/init.pp

sudo mkdir -p code/environments/production/manifests
cd code/environments/production/manifests
sudo vim site.pp

node default { }

node 'webserver.dbzl.test', 'webserver1.dbzl.test' {
  # execute 'apt-get update'
  exec { 'apt update':
   command => '/usr/bin/apt update'
  }

  # install nginx package
  package { 'nginx':
    require => Exec['apt update'],
    ensure => installed,
  }

  # ensure nginx service is running
  service { 'nginx':
    ensure => running,
  }

  file { 'test':
    path => '/tmp/test.txt',
    mode => '755',
    ensure => present,
  }
}


//sudo mkdir manifests
//sudo vim manifests/site.pp
//
//node default { }
//
//node 'webserver.dbzl.test' {
//  include nginx
//}


########################## 
# install on client
##########################
sudo apt install puppet
sudo hostnamectl set-hostname webserver.dbzl.test
sudo vim /etc/hosts
 # put ip and hostname master
 # put ip and hostname client
sudo vim /etc/puppet/puppet.conf

[main]
ssldir = /var/lib/puppet/ssl

[agent]
server= master.dbzl.test
environment = production
runinterval = 2m

#[master]
#vardir = /var/lib/puppet
#cadir  = /var/lib/puppet/ssl/ca
#dns_alt_names = puppet

/etc/init.d/puppet start
sudo puppet agent --test --noop

########################
# check on master
#######################
sudo puppet cert list
sudo puppet cert sign webserver.dbzl.test 
sudo puppet cert list -all


# using bolt
sudo apt-get install puppet-bolt
